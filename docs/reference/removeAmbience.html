<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Remove the ambient profile — removeAmbience • DropletUtils</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Remove the ambient profile — removeAmbience" />
<meta property="og:description" content="Estimate and remove the ambient profile from a count matrix, given pre-existing groupings of similar cells.
This function is largely intended for plot beautification rather than real analysis." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DropletUtils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.13.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/DropletUtils.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Remove the ambient profile</h1>
    
    <div class="hidden name"><code>removeAmbience.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimate and remove the ambient profile from a count matrix, given pre-existing groupings of similar cells.
This function is largely intended for plot beautification rather than real analysis.</p>
    </div>

    <pre class="usage"><span class='fu'>removeAmbience</span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S4 method for ANY</span>
<span class='fu'>removeAmbience</span><span class='op'>(</span>
  <span class='va'>y</span>,
  <span class='va'>ambient</span>,
  <span class='va'>groups</span>,
  features <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>,
  size.factors <span class='op'>=</span> <span class='fu'>librarySizeFactors</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>,
  dispersion <span class='op'>=</span> <span class='fl'>0.1</span>,
  sink <span class='op'>=</span> <span class='cn'>NULL</span>,
  BPPARAM <span class='op'>=</span> <span class='fu'>SerialParam</span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='co'># S4 method for SummarizedExperiment</span>
<span class='fu'>removeAmbience</span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>...</span>, assay.type <span class='op'>=</span> <span class='st'>"counts"</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>y</th>
      <td><p>A numeric matrix-like object containing counts for each gene (row) and cell or group of cells (column).
Alternatively, a SummarizedExperiment containing such a matrix.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>For the generic, further arguments to pass to specific methods.</p>
<p>For the SummarizedExperiment method, further arguments to pass to the ANY method.</p>
<p>For the ANY method, Further arguments to pass to <code><a href='ambientContribMaximum.html'>ambientContribMaximum</a></code>.</p></td>
    </tr>
    <tr>
      <th>ambient</th>
      <td><p>A numeric vector of length equal to <code><a href='https://rdrr.io/r/base/nrow.html'>nrow(y)</a></code>,
containing the proportions of transcripts for each gene in the ambient solution.</p></td>
    </tr>
    <tr>
      <th>groups</th>
      <td><p>A vector of length equal to <code><a href='https://rdrr.io/r/base/nrow.html'>ncol(y)</a></code>, specifying the assigned group for each cell.
This can also be a DataFrame, see <code>?sumCountsAcrossCells</code>.</p></td>
    </tr>
    <tr>
      <th>features</th>
      <td><p>A vector of control features or a list of mutually exclusive feature sets, 
see <code>?<a href='ambientContribNegative.html'>ambientContribNegative</a></code> for more details.</p></td>
    </tr>
    <tr>
      <th>size.factors</th>
      <td><p>Numeric scalar specifying the size factors for each column of <code>y</code>,
defaults to library size-derived size factors.</p></td>
    </tr>
    <tr>
      <th>dispersion</th>
      <td><p>Numeric scalar specifying the dispersion to use in the quantile-quantile mapping.</p></td>
    </tr>
    <tr>
      <th>sink</th>
      <td><p>An optional RealizationSink object of the same dimensions as <code>y</code>.</p></td>
    </tr>
    <tr>
      <th>BPPARAM</th>
      <td><p>A BiocParallelParam object specifying how parallelization should be performed.</p></td>
    </tr>
    <tr>
      <th>assay.type</th>
      <td><p>Integer or string specifying the assay containing the count matrix.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A numeric matrix-like object of the same dimensions as <code>y</code>,
containing the counts after removing the ambient contamination.
The exact representation of the output will depend on the class of <code>y</code> and whether <code>sink</code> was used.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function will aggregate counts from each group of related cells into an average profile.
For each group, we estimate the contribution of the ambient profile and subtract it from the average.
By default, this is done with <code><a href='ambientContribMaximum.html'>ambientContribMaximum</a></code>, but if enough is known about the biological system, users can specify <code>feaures</code> to use <code><a href='ambientContribNegative.html'>ambientContribNegative</a></code> instead.</p>
<p>We then perform quantile-quantile mapping of counts in <code>y</code> from the old to new averages.
This approach preserves the mean-variance relationship and improves the precision of estimate of the ambient contribution, but relies on a sensible grouping of similar cells, e.g., unsupervised clusters or cell type annotations.
As such, this function is best used at the end of the analysis to clean up expression matrices prior to visualization.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='ambientContribMaximum.html'>ambientContribMaximum</a></code> and <code><a href='ambientContribNegative.html'>ambientContribNegative</a></code>, to estimate the ambient contribution.</p>
<p><code><a href='ambientProfileEmpty.html'>estimateAmbience</a></code>, to estimate the ambient profile.</p>
<p>The <span class="pkg">SoupX</span> package, which provides another implementation of the same general approach.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Aaron Lun</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Making up some data.</span>
<span class='va'>ngenes</span> <span class='op'>&lt;-</span> <span class='fl'>1000</span>
<span class='va'>ambient</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='va'>ngenes</span>, <span class='fl'>0</span>, <span class='fl'>0.1</span><span class='op'>)</span>
<span class='va'>cells</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fl'>100</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>10</span>, <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>integer</a></span><span class='op'>(</span><span class='fl'>900</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Poisson.html'>rpois</a></span><span class='op'>(</span><span class='va'>ngenes</span> <span class='op'>*</span> <span class='fl'>100</span>, <span class='va'>cells</span> <span class='op'>+</span> <span class='va'>ambient</span><span class='op'>)</span>, nrow<span class='op'>=</span><span class='va'>ngenes</span><span class='op'>)</span>

<span class='co'># Pretending that all cells are in one group, in this example.</span>
<span class='va'>removed</span> <span class='op'>&lt;-</span> <span class='fu'>removeAmbience</span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>ambient</span>, groups<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowMeans</a></span><span class='op'>(</span><span class='va'>removed</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>100</span>,<span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#&gt;   0.080   3.047   4.515   5.002   7.657  10.550 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowMeans</a></span><span class='op'>(</span><span class='va'>removed</span><span class='op'>[</span><span class='fl'>101</span><span class='op'>:</span><span class='fl'>1000</span>,<span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#&gt; 0.00000 0.00000 0.00000 0.01044 0.00000 0.20000 </div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Aaron Lun.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


